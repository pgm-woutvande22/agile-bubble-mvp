// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

model User {
  id           String      @id @default(cuid())
  name         String
  email        String      @unique
  passwordHash String
  role         Role        @default(USER)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  favorites    Favorite[]
  studyPlans   StudyPlan[]

  @@index([email])
}

model Location {
  id          String   @id @default(cuid())
  externalId  String?  @unique // ID from Ghent Open Data
  name        String
  address     String
  latitude    Float
  longitude   Float
  capacity    Int      @default(50)
  description String?
  type        String?  // bibliotheek, studiezaal, etc.
  website     String?
  openingHours String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  sensor      Sensor?
  favorites   Favorite[]
  studyPlans  StudyPlan[]

  @@index([latitude, longitude])
}

model Sensor {
  id                 String   @id @default(cuid())
  locationId         String   @unique
  deviceId           String?  // Fake sensor device ID
  port               Int?     // Fake sensor port
  password           String?  // Fake sensor password/API key
  currentNoiseLevel  Int      @default(30) // 0-100
  currentOccupancy   Int      @default(0)
  lastUpdated        DateTime @default(now())
  isManualOverride   Boolean  @default(false)

  location           Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@index([locationId])
}

model Favorite {
  id         String   @id @default(cuid())
  userId     String
  locationId String
  createdAt  DateTime @default(now())

  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  location   Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@unique([userId, locationId])
  @@index([userId])
  @@index([locationId])
}

model StudyPlan {
  id         String   @id @default(cuid())
  userId     String
  locationId String
  startTime  DateTime
  endTime    DateTime
  notes      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  location   Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([locationId])
  @@index([startTime, endTime])
}

model SyncLog {
  id          String   @id @default(cuid())
  syncType    String   // "locations" | "sensors"
  status      String   // "success" | "error"
  recordCount Int      @default(0)
  message     String?
  createdAt   DateTime @default(now())
}
